<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Price Calculation</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { padding: 20px; }
        .table th { background-color: #f8f9fa; }
    </style>
</head>
<body>
<div class="container">
    <div class="d-flex justify-content-end align-items-center mb-3">
      <a href="/pricing/" class="btn btn-sm {% if request.path == '/pricing/' %}btn-primary{% else %}btn-outline-primary{% endif %} me-2">
        ðŸ‡·ðŸ‡º RU
      </a>
      <a href="/en/pricing/" class="btn btn-sm {% if '/en/pricing/' in request.path %}btn-primary{% else %}btn-outline-primary{% endif %} me-2">
        ðŸ‡¬ðŸ‡§ EN
      </a>
      <a href="/no/pricing/" class="btn btn-sm {% if '/no/pricing/' in request.path %}btn-primary{% else %}btn-outline-primary{% endif %}">
        ðŸ‡³ðŸ‡´ NO
      </a>
    </div>
    <h1 class="text-center mb-4">Price Calculation</h1>

    <form method="post">
        {% csrf_token %}
        {% if materials %}
        <h3>Material Summary</h3>
        <div class="table-responsive">
            <table class="table table-bordered table-sm table-hover">
            <thead>
            <tr>
                <th>Material</th>
                <th>Length (m)</th>
                <th>Quantity (pcs)</th>
                <th>Price</th>
                <th>Total (NOK)</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>3Ã—8 Beams</td>
                <td>{{ materials.total_3x8_meterage|floatformat:2 }}</td>
                <td>{{ materials.total_3x8_board_count }}</td>
                <td><input type="number" step="0.01" name="price_3x8" class="form-control" placeholder="NOK/m" value="{{ request.POST.price_3x8|default:'' }}"></td>
                <td>{{ result.cost_3x8|default:"-" }}</td>
            </tr>
            <tr>
                <td>3Ã—6 Material</td>
                <td>{{ materials.total_3x6_meterage|floatformat:2 }}</td>
                <td>{{ materials.total_3x6_board_count }}</td>
                <td><input type="number" step="0.01" name="price_3x6" class="form-control" placeholder="NOK/m" value="{{ request.POST.price_3x6|default:'' }}"></td>
                <td>{{ result.cost_3x6|default:"-" }}</td>
            </tr>
            <tr>
                <td>{{ materials.beam_size }} Guiding Beam</td>
                <td>{{ materials.total_guiding_meterage|floatformat:2 }}</td>
                <td>{{ materials.total_guiding_board_count }}</td>
                <td>
                    {% if materials.beam_size == "6x6" %}
                        <input type="number" step="0.01" name="price_6x6" class="form-control" placeholder="NOK/m" value="{{ request.POST.price_6x6|default:'' }}">
                    {% else %}
                        <input type="number" step="0.01" name="price_8x8" class="form-control" placeholder="NOK/m" value="{{ request.POST.price_8x8|default:'' }}">
                    {% endif %}
                </td>
                <td>
                    {% if materials.beam_size == "6x6" %}
                        {{ result.cost_6x6|default:"-" }}
                    {% else %}
                        {{ result.cost_8x8|default:"-" }}
                    {% endif %}
                </td>
            </tr>
            <tr>
                <td>Posts</td>
                <td>-</td>
                <td>{{ materials.total_posts_count }}</td>
                <td><input type="number" step="0.01" name="price_post" class="form-control" placeholder="NOK/pcs" value="{{ request.POST.price_post|default:'' }}"></td>
                <td>{{ result.cost_posts|default:"-" }}</td>
            </tr>
            <tr>
                <td>30 mm Screws</td>
                <td>-</td>
                <td>{{ materials.total_screws_30 }}</td>
                <td><input type="number" step="0.01" name="price_screw_30" class="form-control" placeholder="NOK/pcs" value="{{ request.POST.price_screw_30|default:'' }}"></td>
                <td>{{ result.cost_screws_30|default:"-" }}</td>
            </tr>
            <tr>
                <td>40 mm Screws</td>
                <td>-</td>
                <td>{{ materials.total_screws_40 }}</td>
                <td><input type="number" step="0.01" name="price_screw_40" class="form-control" placeholder="NOK/pcs" value="{{ request.POST.price_screw_40|default:'' }}"></td>
                <td>{{ result.cost_screws_40|default:"-" }}</td>
            </tr>
            <tr>
                <td>Bolts</td>
                <td>{{ materials.total_bolt_meterage_purchase|floatformat:2 }}</td>
                <td>{{ materials.total_bolt_count }}</td>
                <td><input type="number" step="0.01" name="price_bolt" class="form-control" placeholder="NOK/m" value="{{ request.POST.price_bolt|default:'' }}"></td>
                <td>{{ result.cost_bolts|default:"-" }}</td>
            </tr>
            <tr>
                <td>Nuts</td>
                <td>-</td>
                <td>{{ materials.total_nuts_count }}</td>
                <td><input type="number" step="0.01" name="price_nut" class="form-control" placeholder="NOK/pcs" value="{{ request.POST.price_nut|default:'' }}"></td>
                <td>{{ result.cost_nuts|default:"-" }}</td>
            </tr>
            <tr>
                <td>Washers</td>
                <td>-</td>
                <td>{{ materials.total_washers_count }}</td>
                <td><input type="number" step="0.01" name="price_washer" class="form-control" placeholder="NOK/pcs" value="{{ request.POST.price_washer|default:'' }}"></td>
                <td>{{ result.cost_washers|default:"-" }}</td>
            </tr>
            </tbody>
            </table>
        </div>
        {% endif %}

        <h3 class="mt-4">Work Cost</h3>
        <div class="row">
            <div class="col-md-6">
                <label class="form-label">Price per day (NOK):</label>
                <input type="number" step="0.01" name="price_day" class="form-control" placeholder="NOK/day" value="{{ request.POST.price_day|default:'' }}">
            </div>
            <div class="col-md-6">
                <label class="form-label">Number of days:</label>
                <input type="number" name="days" class="form-control" value="{{ request.POST.days|default:'' }}">
            </div>
        </div>

        <div class="mt-4">
            <button type="submit" name="action" value="calculate" class="btn btn-primary">Calculate</button>
            <button type="submit" name="action" value="download_pdf" class="btn btn-success">Save as PDF</button>
            <div class="form-check mt-2">
                <input class="form-check-input" type="checkbox" name="include_details" id="includeDetails" value="1">
                <label class="form-check-label" for="includeDetails">
                    Include detailed material table in PDF
                </label>
            </div>
            <a href="{% url 'index_en' %}" class="btn btn-secondary mt-3">Back</a>
        </div>
    </form>

    {% if result %}
    <hr>
    <h3>Totals</h3>
    <div class="table-responsive">
        <table class="table table-striped table-sm table-hover">
            <tr><th>Total materials</th><td>{{ result.total_materials|floatformat:2 }}</td></tr>
            <tr><th>Work</th><td>{{ result.total_work|floatformat:2 }}</td></tr>
            <tr class="table-success"><th>Total price</th><td>{{ result.total_price|floatformat:2 }}</td></tr>
        </table>
    </div>
    {% endif %}

    {% if error %}
    <div class="alert alert-danger mt-3">{{ error }}</div>
    {% endif %}
</div>
</body>
</html>